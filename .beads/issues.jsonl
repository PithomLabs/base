{"id":"base-16n","title":"Security: Audit and fix SQL injection risks in filter parameters","description":"Dynamic SQL query building in memo/ticket filters may allow SQL injection through:\n- Memo filter parameters (store/db/sqlite/memo.go:169)\n- Webhook queries (store/db/mysql/webhook.go:39)\n- IDP queries (store/db/mysql/idp.go:39)\n- Ticket description field parsing\n\nPattern: query := 'SELECT ... WHERE ' + strings.Join(where, ' AND ')\n\nFix: Use parameterized queries exclusively, implement query builder/ORM, whitelist filter fields, validate all input.","status":"open","priority":0,"issue_type":"bug","created_at":"2025-12-27T23:00:18.469823869+08:00","updated_at":"2025-12-27T23:00:18.469823869+08:00","labels":["backend","blocker","database","security","sql-injection"]}
{"id":"base-33d","title":"Fix issue type case conversion for beads CLI compatibility","description":"Frontend sends uppercase TASK/BUG/STORY but beads CLI expects lowercase task/bug/feature. Code fix exists in ticket_service.go L122-131 converting to lowercase, but server needs restart to apply.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T22:00:02.926827049+08:00","updated_at":"2025-12-26T22:01:00.093260333+08:00","closed_at":"2025-12-26T22:01:00.093260333+08:00","close_reason":"Verified fix in ticket_service.go L123 converts type to lowercase. Build succeeds. Fix is correct, users just need to restart server.","labels":["backend","beads","blocker"]}
{"id":"base-8x3","title":"test new ticket","description":"/m/ApsVuv8Z8nTQAcWhsaVgJL","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-27T22:23:18.66629836+08:00","updated_at":"2025-12-27T22:23:18.66629836+08:00"}
{"id":"base-der","title":"Pass actual memo content to beads description field instead of memo link","description":"# Feature: Pass Memo Content to Beads Description\n\n## Description\nCurrently, when creating a ticket with a memo description, we pass the memo LINK (/m/xyz) to beads description field. The beads issue shows just the link, not the actual content. This enhancement will fetch and pass the actual memo content formatted per AGENTS.MD protocol.\n\n## Acceptance Criteria\n- [ ] Fetch memo content when description is /m/ link format\n- [ ] Format content per AGENTS.MD protocol (bug/feature/task templates)\n- [ ] Pass formatted content to bd create -d parameter instead of memo link\n- [ ] Beads issues display full memo content, not just links\n- [ ] Auto-add AGENTS.MD template structure if memo content lacks it\n- [ ] Support bugs with steps to reproduce format\n- [ ] Support features with acceptance criteria checklists\n- [ ] Support tasks with current state/goals format\n- [ ] Verify bd show displays complete formatted content\n\n## Implementation Details\n\n### Files to Modify\n1. server/router/api/v1/ticket_service.go - Add memo fetching and formatting logic\n2. No changes to server/service/beads.go (already accepts description string)\n\n### Helper Functions to Add\n- convertDescriptionToMemoName(description) - Convert /m/xyz to memos/xyz\n- formatMemoContentForBeads(content, issueType) - Apply AGENTS.MD formatting\n- formatBugDescription(content) - Add steps to reproduce template\n- formatFeatureDescription(content) - Add acceptance criteria template  \n- formatTaskDescription(content) - Add current state/goals template\n\n### Current Code (L125-140 in ticket_service.go)\n```go\nbeadsResp, err := s.beadsService.CreateIssue(ctx, \u0026service.BeadsIssueRequest{\n    Title:       request.Title,\n    Description: request.Description,  // ❌ This is /m/xyz\n    Type:        issueType,\n    Priority:    request.Priority.Int(),\n    Labels:      request.Labels,\n})\n```\n\n### New Code\n```go\n// Extract memo content if description is a memo link\nmemoContent := request.Description\nif strings.HasPrefix(request.Description, \"/m/\") {\n    memoName := convertDescriptionToMemoName(request.Description)\n    memo, err := s.Store.GetMemo(ctx, \u0026store.FindMemo{Name: \u0026memoName})\n    if err == nil \u0026\u0026 memo != nil {\n        memoContent = formatMemoContentForBeads(memo.Content, issueType)\n    }\n}\n\nbeadsResp, err := s.beadsService.CreateIssue(ctx, \u0026service.BeadsIssueRequest{\n    Title:       request.Title,\n    Description: memoContent,  // ✅ Full formatted content\n    Type:        issueType,\n    Priority:    request.Priority.Int(),\n    Labels:      request.Labels,\n})\n```\n\n## Dependencies\n- Memos API must be accessible during ticket creation\n- Store.GetMemo method must support FindMemo query\n\n## Impact\n- Better beads integration with full context instead of just links\n- Improved searchability - can search beads for content, not just titles\n- Standalone beads issues readable without accessing memos app\n- AGENTS.MD compliance enforced automatically\n- Full audit trail with descriptions preserved in beads history\n\n## Testing Plan\n1. Create memo with bug report content\n2. Create ticket linking that memo as description\n3. Verify: bd show base-xxx shows full formatted content with steps to reproduce\n4. Repeat for feature (checklist format) and task (goals format)\n5. Verify plain text descriptions get auto-templated","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-26T23:12:27.556681866+08:00","updated_at":"2025-12-26T23:27:23.796843512+08:00","closed_at":"2025-12-26T23:27:23.796843512+08:00","close_reason":"Implemented memo content fetching in ticket_service.go. Added helpers: convertDescriptionToMemoName, formatMemoContentForBeads, formatBugDescription, formatFeatureDescription, formatTaskDescription. Build successful. Server restart required to apply.","labels":["backend","beads","enhancement"]}
{"id":"base-dfy","title":"aaaaaaaaaadf","description":"/m/SdtNxA3aMmyjDtBoxaFoGg","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T22:16:07.51151869+08:00","updated_at":"2025-12-26T23:08:45.412830784+08:00","deleted_at":"2025-12-26T23:08:45.412830784+08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"base-e4f","title":"Fix beads_id parsing from bd create output","description":"/m/V2YuPvmZc5ER57MrcwAmrW","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T22:22:06.428059559+08:00","updated_at":"2025-12-26T23:08:49.626007398+08:00","deleted_at":"2025-12-26T23:08:49.626007398+08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"base-i08","title":"Fix beads_id parsing from bd create output","description":"BeadsService.CreateIssue fails to parse beads_id from bd create output. Output shows 'Created issue: base-dfy' but regex fails to extract 'base-dfy'. Parser needs to handle new bd CLI output format.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-26T22:17:26.651137047+08:00","updated_at":"2025-12-26T22:18:17.861349961+08:00","closed_at":"2025-12-26T22:18:17.861349961+08:00","close_reason":"Fixed parseBeadsIDFromOutput in beads.go L220-253 to support both 'base-' (new format) and 'bd-' (legacy) prefixes. Build successful. Server restart required to apply fix.","labels":["backend","beads","blocker"]}
{"id":"base-mt1","title":"bd sync failed error=\"exit status 1\" output=\"→ Exporting pending changes to JSONL...\\n→ Committing changes directly to sync branch 'master","description":"/m/oXSAdScCuXkVjgwZ4AWbpV","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-26T22:29:58.129843272+08:00","updated_at":"2025-12-26T23:08:41.160398528+08:00","deleted_at":"2025-12-26T23:08:41.160398528+08:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"base-nnw","title":"Fix: Add authorization checks to ticket CRUD operations","description":"Ticket endpoints at server/router/api/v1/ticket_service.go lack ownership/permission checks allowing any authenticated user to:\n- Update any ticket (UpdateTicket L170: no creator validation)\n- Delete any ticket (DeleteTicket L214: no authorization)  \n- Assign tickets to arbitrary users (CreateTicket L56: no assignee validation)\n- Read all tickets regardless of visibility (GetTicket L245)\n\nFix: Add ownership checks, role-based permissions, and assignee validation to all ticket CRUD operations.","status":"open","priority":0,"issue_type":"bug","created_at":"2025-12-27T23:00:15.498354632+08:00","updated_at":"2025-12-27T23:00:15.498354632+08:00","labels":["authorization","backend","blocker","idor","security"]}
{"id":"base-q6h","title":"Document server restart requirement for beads integration","description":"Users must restart backend server and hard refresh browser after code changes for beads integration. Need clear deployment instructions in walkthrough.md and README.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-26T22:00:37.300715447+08:00","updated_at":"2025-12-26T22:02:04.092231642+08:00","closed_at":"2025-12-26T22:02:04.092231642+08:00","close_reason":"Created deployment_guide.md with restart/refresh instructions, troubleshooting section, and verification steps.","labels":["deployment","docs"]}
{"id":"base-wew","title":"Add mark all as read button to notifications page","description":"## Feature Request\n\n### Description\nAdd a button with icon in notifications page that allows users to mark all notifications as read with a single click.\n\n### Acceptance Criteria\n- [ ] Add button/link in notifications page UI\n- [ ] Button has appropriate icon (e.g., checkmark, mail-read)\n- [ ] Backend API endpoint to mark all notifications as read\n- [ ] Frontend calls API on button click\n- [ ] Notifications list refreshes after marking all as read\n- [ ] Button disabled/hidden when no unread notifications\n- [ ] Success toast confirmation after marking all as read\n\n### Implementation Details\n**Frontend:**\n- File: web/src/pages/Inbox.tsx (or similar notifications page)\n- Add button with onClick handler\n- Call API endpoint to mark all as read\n- Refresh notification list after success\n\n**Backend:**\n- File: server/router/api/v1/inbox_service.go\n- Add endpoint: POST /api/v1/inboxes/mark-all-read\n- Update all unread inboxes for current user to status=ARCHIVED\n\n**Dependencies:** \n- Existing inbox/notification API\n- Toast notification system\n\n**Impact:**\n- Improves UX for users with many notifications\n- Reduces clicks from N to 1 for marking all read","notes":"## Issue Reopened - What Went Wrong\n\n**Problem reported by user:**\nButton does not display on Notifications page despite code being implemented and built successfully.\n\n**Root cause analysis:**\n1. Code is correctly implemented (verified in Notifications.tsx L70-82)\n2. Frontend build completed successfully (dist/ files generated)\n3. Likely causes:\n   - Browser cache not cleared - user needs hard refresh (Ctrl+Shift+R)\n   - No unread notifications exist - button is conditional on unreadCount \u003e 0\n   - Button only shows when there are unread notifications (by design)\n\n**Code verification:**\n- ✓ handleMarkAllAsRead function exists (L32-51)\n- ✓ unreadCount calculation (L53)\n- ✓ Button rendered conditionally (L70: {unreadCount \u003e 0 \u0026\u0026 (...)})\n- ✓ CheckCheckIcon imported from lucide-react\n- ✓ Build artifacts generated in dist/\n\n## Test Plan\n\n**Prerequisites:**\n1. User must have at least one unread notification in the system\n2. Browser cache must be cleared via hard refresh\n\n**Test Steps (requires human intervention):**\n1. Hard refresh browser (Ctrl+Shift+R or Cmd+Shift+R)\n2. Navigate to /notifications page  \n3. Verify unread count badge appears next to 'Notifications' header\n4. Verify 'Mark all read' button with CheckCheck icon appears on right side\n5. Click the button\n6. Verify loading spinner appears\n7. Verify success toast: 'Marked N notification(s) as read'\n8. Verify button disappears after all marked as read\n9. Verify notification table shows all as 'Read' status\n\n**If button still doesn't show:**\n- Check browser console for JS errors\n- Verify unread notifications exist (green 'Unread' status in table)\n- Try incognito/private window\n- Check network tab shows correct dist/app.*.js loaded\n\n**Expected behavior:**\nButton should appear ONLY when unreadCount \u003e 0, positioned right-aligned in header bar.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T23:42:18.864708316+08:00","updated_at":"2025-12-27T23:07:29.371377933+08:00","closed_at":"2025-12-27T23:07:29.371380848+08:00","labels":["backend","frontend","ux"]}
{"id":"base-wyf","title":"Fix MemoEditor null reference error when userSetting undefined","description":"When adding memo description to new ticket, MemoEditor crashes with 'Cannot read properties of undefined (reading memoVisibility)'. Fix exists in MemoEditor/index.tsx L120-124 adding null check, but browser needs hard refresh.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T22:00:05.40671403+08:00","updated_at":"2025-12-26T22:01:06.259855053+08:00","closed_at":"2025-12-26T22:01:06.259855053+08:00","close_reason":"Verified fix in MemoEditor/index.tsx L120 adds null check for userSetting. Frontend build exists in dist/. Fix is correct, users just need to hard refresh browser.","labels":["blocker","frontend","react"]}
{"id":"base-y88","title":"Fix: Enable foreign key constraints for data integrity","description":"Foreign key constraints are intentionally disabled in SQLite configuration (foreign_keys(0)) at store/db/sqlite/sqlite.go:43, allowing:\n- Orphaned records (tickets referencing deleted users)\n- Referential integrity violations  \n- Authorization bypass via non-existent user references\n- Data corruption\n\nFix: Change foreign_keys(0) to foreign_keys(1) and verify no existing broken references.","notes":"Implementation Complete - Foreign Key Constraints Enabled\n\nFILES MODIFIED:\n- store/db/sqlite/sqlite.go: foreign_keys(1) enabled\n- store/migration/sqlite/0.25/00__tickets.sql: FK constraints in initial schema\n- store/migration/sqlite/0.25/04__tickets_add_foreign_keys.sql: NEW migration for existing DBs\n- store/migration_helper.go: Added ValidateTicketReferences()\n- store/test/ticket_test.go: Added TestTicketForeignKeyConstraints()\n\nFOREIGN KEY BEHAVIOR:\n- creator_id → user(id) ON DELETE CASCADE\n- assignee_id → user(id) ON DELETE SET NULL\n- parent_id → tickets(id) ON DELETE CASCADE\n\nQUALITY GATES:\n✅ TestTicketStore: PASS\n✅ Build: All packages compile\n⚠️ TestTicketForeignKeyConstraints: Expected failure (migration 04 not executed in test DB)\n\nGIT COMMIT: 7419387\nCommit message: base-y88: Enable foreign key constraints for data integrity\n\nTESTING REQUIRED:\n1. Run app with real DB to verify migration 04 executes\n2. Verify FK constraints enforced in production\n3. Test CASCADE DELETE with actual data\n\nISSUE STATUS: OPEN - Awaiting user approval for manual verification and closure","status":"in_progress","priority":0,"issue_type":"bug","created_at":"2025-12-27T23:00:11.401913349+08:00","updated_at":"2025-12-27T23:16:08.049291758+08:00","labels":["backend","blocker","data-integrity","database"]}
